

\subsection{$\mathbf{(\sum AA^T)_k}$}



{\bf k = 1}

\begin{lstlisting}
n = 100;
m = 200;
A = randn(n, m);
original = (sum((sum(A, 1)), 2));

optimized = 1 * ((sum(((sum(A, 1))'), 1)));
normalization = sum(abs(original(:)));
assert(sum(abs(original(:) - optimized(:))) / normalization < 1e-10);
\end{lstlisting}


{\bf k = 2}

\begin{lstlisting}
n = 100;
m = 200;
A = randn(n, m);
original = (sum((sum((A * (A')), 1)), 2));

optimized = 1 * ((sum((A * (sum((A'), 2))), 1)));
normalization = sum(abs(original(:)));
assert(sum(abs(original(:) - optimized(:))) / normalization < 1e-10);
\end{lstlisting}


{\bf k = 3}

\begin{lstlisting}
n = 100;
m = 200;
A = randn(n, m);
original = (sum((sum(((A * (A')) * A), 1)), 2));

optimized = 1 * ((sum(((((A * ((sum(A, 1))'))') * A)'), 1)));
normalization = sum(abs(original(:)));
assert(sum(abs(original(:) - optimized(:))) / normalization < 1e-10);
\end{lstlisting}


{\bf k = 4}

\begin{lstlisting}
n = 100;
m = 200;
A = randn(n, m);
original = (sum((sum((((A * (A')) * A) * (A')), 1)), 2));

optimized = 1 * ((sum(((A * ((((A * (sum((A'), 2)))') * A)'))'), 2)));
normalization = sum(abs(original(:)));
assert(sum(abs(original(:) - optimized(:))) / normalization < 1e-10);
\end{lstlisting}


{\bf k = 5}

\begin{lstlisting}
n = 100;
m = 200;
A = randn(n, m);
original = (sum((sum(((((A * (A')) * A) * (A')) * A), 1)), 2));

optimized = 1 * ((sum(((((A * ((((A * ((sum(A, 1))'))') * A)'))') * A)'), 1)));
normalization = sum(abs(original(:)));
assert(sum(abs(original(:) - optimized(:))) / normalization < 1e-10);
\end{lstlisting}


{\bf k = 6}

\begin{lstlisting}
n = 100;
m = 200;
A = randn(n, m);
original = (sum((sum((((((A * (A')) * A) * (A')) * A) * (A')), 1)), 2));

optimized = 1 * ((sum(((A * ((((A * ((((A * ((sum(A, 1))'))') * A)'))') * A)'))'), 2)));
normalization = sum(abs(original(:)));
assert(sum(abs(original(:) - optimized(:))) / normalization < 1e-10);
\end{lstlisting}


{\bf k = 7}

\begin{lstlisting}
n = 100;
m = 200;
A = randn(n, m);
original = (sum((sum(((((((A * (A')) * A) * (A')) * A) * (A')) * A), 1)), 2));

optimized = 1 * ((sum(((((A * ((((A * ((((A * ((sum(A, 1))'))') * A)'))') * A)'))') * A)'), 1)));
normalization = sum(abs(original(:)));
assert(sum(abs(original(:) - optimized(:))) / normalization < 1e-10);
\end{lstlisting}


{\bf k = 8}

\begin{lstlisting}
n = 100;
m = 200;
A = randn(n, m);
original = (sum((sum((((((((A * (A')) * A) * (A')) * A) * (A')) * A) * (A')), 1)), 2));

optimized = 1 * ((sum(((A * ((((A * ((((A * ((((A * ((sum(A, 1))'))') * A)'))') * A)'))') * A)'))'), 2)));
normalization = sum(abs(original(:)));
assert(sum(abs(original(:) - optimized(:))) / normalization < 1e-10);
\end{lstlisting}


{\bf k = 9}

\begin{lstlisting}
n = 100;
m = 200;
A = randn(n, m);
original = (sum((sum(((((((((A * (A')) * A) * (A')) * A) * (A')) * A) * (A')) * A), 1)), 2));

optimized = 1 * ((sum(((((A * ((((A * ((((A * ((((A * ((sum(A, 1))'))') * A)'))') * A)'))') * A)'))') * A)'), 1)));
normalization = sum(abs(original(:)));
assert(sum(abs(original(:) - optimized(:))) / normalization < 1e-10);
\end{lstlisting}


{\bf k = 10}

\begin{lstlisting}
n = 100;
m = 200;
A = randn(n, m);
original = (sum((sum((((((((((A * (A')) * A) * (A')) * A) * (A')) * A) * (A')) * A) * (A')), 1)), 2));

optimized = 1 * ((sum(((A * ((((A * ((((A * ((((A * ((((A * ((sum(A, 1))'))') * A)'))') * A)'))') * A)'))') * A)'))'), 2)));
normalization = sum(abs(original(:)));
assert(sum(abs(original(:) - optimized(:))) / normalization < 1e-10);
\end{lstlisting}


{\bf k = 11}

\begin{lstlisting}
n = 100;
m = 200;
A = randn(n, m);
original = (sum((sum(((((((((((A * (A')) * A) * (A')) * A) * (A')) * A) * (A')) * A) * (A')) * A), 1)), 2));

optimized = 1 * ((sum(((((A * ((((A * ((((A * ((((A * ((((A * ((sum(A, 1))'))') * A)'))') * A)'))') * A)'))') * A)'))') * A)'), 1)));
normalization = sum(abs(original(:)));
assert(sum(abs(original(:) - optimized(:))) / normalization < 1e-10);
\end{lstlisting}


{\bf k = 12}

\begin{lstlisting}
n = 100;
m = 200;
A = randn(n, m);
original = (sum((sum((((((((((((A * (A')) * A) * (A')) * A) * (A')) * A) * (A')) * A) * (A')) * A) * (A')), 1)), 2));

optimized = 1 * ((sum(((A * ((((A * ((((A * ((((A * ((((A * ((((A * ((sum(A, 1))'))') * A)'))') * A)'))') * A)'))') * A)'))') * A)'))'), 2)));
normalization = sum(abs(original(:)));
assert(sum(abs(original(:) - optimized(:))) / normalization < 1e-10);
\end{lstlisting}


{\bf k = 13}

\begin{lstlisting}
n = 100;
m = 200;
A = randn(n, m);
original = (sum((sum(((((((((((((A * (A')) * A) * (A')) * A) * (A')) * A) * (A')) * A) * (A')) * A) * (A')) * A), 1)), 2));

optimized = 1 * ((sum(((((A * ((((A * ((((A * ((((A * ((((A * ((((A * ((sum(A, 1))'))') * A)'))') * A)'))') * A)'))') * A)'))') * A)'))') * A)'), 1)));
normalization = sum(abs(original(:)));
assert(sum(abs(original(:) - optimized(:))) / normalization < 1e-10);
\end{lstlisting}


{\bf k = 14}

\begin{lstlisting}
n = 100;
m = 200;
A = randn(n, m);
original = (sum((sum((((((((((((((A * (A')) * A) * (A')) * A) * (A')) * A) * (A')) * A) * (A')) * A) * (A')) * A) * (A')), 1)), 2));

optimized = 1 * ((sum(((A * ((((A * ((((A * ((((A * ((((A * ((((A * ((((A * ((sum(A, 1))'))') * A)'))') * A)'))') * A)'))') * A)'))') * A)'))') * A)'))'), 2)));
normalization = sum(abs(original(:)));
assert(sum(abs(original(:) - optimized(:))) / normalization < 1e-10);
\end{lstlisting}


\subsection{$\mathbf{(\sum AB)_k}$}



{\bf k = 1}

\begin{lstlisting}
n = 100;
m = 200;
A = randn(n, m);
B = randn(m, n);
original = (sum((sum(A, 1)), 2));

optimized = 1 * ((sum((sum(A, 2)), 1)));
normalization = sum(abs(original(:)));
assert(sum(abs(original(:) - optimized(:))) / normalization < 1e-10);
\end{lstlisting}


{\bf k = 2}

\begin{lstlisting}
n = 100;
m = 200;
A = randn(n, m);
B = randn(m, n);
original = (sum((sum((A * B), 1)), 2));

optimized = 1 * (((sum((B'), 1)) * (sum((A'), 2))));
normalization = sum(abs(original(:)));
assert(sum(abs(original(:) - optimized(:))) / normalization < 1e-10);
\end{lstlisting}


{\bf k = 3}

\begin{lstlisting}
n = 100;
m = 200;
A = randn(n, m);
B = randn(m, n);
original = (sum((sum(((A * B) * A), 1)), 2));

optimized = 1 * ((sum((A * (B * (sum(A, 2)))), 1)));
normalization = sum(abs(original(:)));
assert(sum(abs(original(:) - optimized(:))) / normalization < 1e-10);
\end{lstlisting}


{\bf k = 4}

\begin{lstlisting}
n = 100;
m = 200;
A = randn(n, m);
B = randn(m, n);
original = (sum((sum((((A * B) * A) * B), 1)), 2));

optimized = 1 * ((sum((A * (B * (A * (sum(B, 2))))), 1)));
normalization = sum(abs(original(:)));
assert(sum(abs(original(:) - optimized(:))) / normalization < 1e-10);
\end{lstlisting}


{\bf k = 5}

\begin{lstlisting}
n = 100;
m = 200;
A = randn(n, m);
B = randn(m, n);
original = (sum((sum(((((A * B) * A) * B) * A), 1)), 2));

optimized = 1 * ((sum((A * (B * (A * (B * (sum(A, 2)))))), 1)));
normalization = sum(abs(original(:)));
assert(sum(abs(original(:) - optimized(:))) / normalization < 1e-10);
\end{lstlisting}


{\bf k = 6}

\begin{lstlisting}
n = 100;
m = 200;
A = randn(n, m);
B = randn(m, n);
original = (sum((sum((((((A * B) * A) * B) * A) * B), 1)), 2));

optimized = 1 * ((sum((A * (B * (A * (B * (A * (sum(B, 2))))))), 1)));
normalization = sum(abs(original(:)));
assert(sum(abs(original(:) - optimized(:))) / normalization < 1e-10);
\end{lstlisting}


{\bf k = 7}

\begin{lstlisting}
n = 100;
m = 200;
A = randn(n, m);
B = randn(m, n);
original = (sum((sum(((((((A * B) * A) * B) * A) * B) * A), 1)), 2));

optimized = 1 * ((sum((A * (B * (A * (B * (A * (B * (sum(A, 2)))))))), 1)));
normalization = sum(abs(original(:)));
assert(sum(abs(original(:) - optimized(:))) / normalization < 1e-10);
\end{lstlisting}


{\bf k = 8}

\begin{lstlisting}
n = 100;
m = 200;
A = randn(n, m);
B = randn(m, n);
original = (sum((sum((((((((A * B) * A) * B) * A) * B) * A) * B), 1)), 2));

optimized = 1 * ((sum((A * (B * (A * (B * (A * (B * (A * (sum(B, 2))))))))), 1)));
normalization = sum(abs(original(:)));
assert(sum(abs(original(:) - optimized(:))) / normalization < 1e-10);
\end{lstlisting}


{\bf k = 9}

\begin{lstlisting}
n = 100;
m = 200;
A = randn(n, m);
B = randn(m, n);
original = (sum((sum(((((((((A * B) * A) * B) * A) * B) * A) * B) * A), 1)), 2));

optimized = 1 * ((sum((A * (B * (A * (B * (A * (B * (A * (B * (sum(A, 2)))))))))), 1)));
normalization = sum(abs(original(:)));
assert(sum(abs(original(:) - optimized(:))) / normalization < 1e-10);
\end{lstlisting}


{\bf k = 10}

\begin{lstlisting}
n = 100;
m = 200;
A = randn(n, m);
B = randn(m, n);
original = (sum((sum((((((((((A * B) * A) * B) * A) * B) * A) * B) * A) * B), 1)), 2));

optimized = 1 * ((sum((A * (B * (A * (B * (A * (B * (A * (B * (A * (sum(B, 2))))))))))), 1)));
normalization = sum(abs(original(:)));
assert(sum(abs(original(:) - optimized(:))) / normalization < 1e-10);
\end{lstlisting}


{\bf k = 11}

\begin{lstlisting}
n = 100;
m = 200;
A = randn(n, m);
B = randn(m, n);
original = (sum((sum(((((((((((A * B) * A) * B) * A) * B) * A) * B) * A) * B) * A), 1)), 2));

optimized = 1 * ((sum((A * (B * (A * (B * (A * (B * (A * (B * (A * (B * (sum(A, 2)))))))))))), 1)));
normalization = sum(abs(original(:)));
assert(sum(abs(original(:) - optimized(:))) / normalization < 1e-10);
\end{lstlisting}


{\bf k = 12}

\begin{lstlisting}
n = 100;
m = 200;
A = randn(n, m);
B = randn(m, n);
original = (sum((sum((((((((((((A * B) * A) * B) * A) * B) * A) * B) * A) * B) * A) * B), 1)), 2));

optimized = 1 * ((sum((A * (B * (A * (B * (A * (B * (A * (B * (A * (B * (A * (sum(B, 2))))))))))))), 1)));
normalization = sum(abs(original(:)));
assert(sum(abs(original(:) - optimized(:))) / normalization < 1e-10);
\end{lstlisting}


{\bf k = 13}

\begin{lstlisting}
n = 100;
m = 200;
A = randn(n, m);
B = randn(m, n);
original = (sum((sum(((((((((((((A * B) * A) * B) * A) * B) * A) * B) * A) * B) * A) * B) * A), 1)), 2));

optimized = 1 * ((sum((A * (B * (A * (B * (A * (B * (A * (B * (A * (B * (A * (B * (sum(A, 2)))))))))))))), 1)));
normalization = sum(abs(original(:)));
assert(sum(abs(original(:) - optimized(:))) / normalization < 1e-10);
\end{lstlisting}


{\bf k = 14}

\begin{lstlisting}
n = 100;
m = 200;
A = randn(n, m);
B = randn(m, n);
original = (sum((sum((((((((((((((A * B) * A) * B) * A) * B) * A) * B) * A) * B) * A) * B) * A) * B), 1)), 2));

optimized = 1 * ((sum((A * (B * (A * (B * (A * (B * (A * (B * (A * (B * (A * (B * (A * (sum(B, 2))))))))))))))), 1)));
normalization = sum(abs(original(:)));
assert(sum(abs(original(:) - optimized(:))) / normalization < 1e-10);
\end{lstlisting}
