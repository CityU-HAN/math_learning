n = 1;
m = 18;
A = randn(1, m);
sub = nchoosek(1:m, 8);
original = 0;
for i = 1:size(sub, 1)
  original = original + prod(A(sub(i, :)));
end

optimized = (5 / 8 * (sum((repmat(sum((repmat(sum((repmat(sum((repmat(sum(((repmat(sum((A .* A), 2), 1, m) .* A) .* A), 2), 1, m) .* A), 2), 1, m) .* A), 2), 1, m) .* A), 2), 1, m) .* A), 2)) + -5 / 4 * (sum((repmat(sum((repmat(sum(((repmat(sum(((repmat(sum((A .* A), 2), 1, m) .* A) .* A), 2), 1, m) .* A) .* A), 2), 1, m) .* A), 2), 1, m) .* A), 2)) + 4 * (sum((repmat(sum((repmat(sum(A, 2), 1, m) .* (repmat(sum((((A .* A)' .* (A .* A)') .* A')', 2), 1, m) .* A)), 2), 1, m) .* A), 2)) + -5 / 4 * (sum((repmat(sum((repmat(sum((repmat(sum(A, 2), 1, m) .* (repmat(sum(((A .* A)' .* (A .* A)')', 2), 1, m) .* A)), 2), 1, m) .* A), 2), 1, m) .* A), 2)) + 5 / 16 * (sum(((repmat(sum(((repmat(sum(((repmat(sum((A .* A), 2), 1, m) .* A) .* A), 2), 1, m) .* A) .* A), 2), 1, m) .* A) .* A), 2)) + 10 * (sum((((repmat(sum((A .* A), 2), 1, m) .* A)' .* (A .* A)')' .* ((A' .* A') .* A')'), 2)) + 8 * (sum(((repmat(sum((((A .* A)' .* (A .* A)') .* A')', 2), 1, m) .* A)' .* (A .* A)')', 2)) + -10 * (sum((repmat(sum((repmat(sum((((A' .* A') .* A')' .* ((A' .* A') .* A')'), 2), 1, m) .* A), 2), 1, m) .* A), 2)) + 5 * (sum((repmat(sum(((repmat(sum(((repmat(sum((A .* A), 2), 1, m) .* A)' .* (A .* A)')', 2), 1, m) .* A) .* A), 2), 1, m) .* A), 2)) + 10 / 3 * (sum((repmat(sum(A, 2), 1, m) .* (repmat(sum(((repmat(sum(((A' .* A') .* A')', 2), 1, m) .* A)' .* (A .* A)')', 2), 1, m) .* A)), 2)) + 120 / 7 * (sum((repmat(sum((((A .* A)' .* (A .* A)')' .* ((A' .* A') .* A')'), 2), 1, m) .* A), 2)) + 15 / 2 * (sum((repmat(sum((repmat(sum(((repmat(sum(((A .* A)' .* (A .* A)')', 2), 1, m) .* A) .* A), 2), 1, m) .* A), 2), 1, m) .* A), 2)) + 15 / 4 * (sum((((repmat(sum(((A .* A)' .* (A .* A)')', 2), 1, m) .* A)' .* (A .* A)') .* A')', 2)) + -1 / 12 * (sum((repmat(sum((repmat(sum((repmat(sum(((repmat(sum((repmat(sum(A, 2), 1, m) .* (repmat(sum(A, 2), 1, m) .* A)), 2), 1, m) .* A) .* A), 2), 1, m) .* A), 2), 1, m) .* A), 2), 1, m) .* A), 2)) + -15 * (sum(((((A .* A)' .* (A .* A)') .* A')' .* ((A' .* A') .* A')'), 2)) + -10 / 3 * (sum((repmat(sum((repmat(sum(A, 2), 1, m) .* (repmat(sum(((repmat(sum((A .* A), 2), 1, m) .* A)' .* (A .* A)')', 2), 1, m) .* A)), 2), 1, m) .* A), 2)) + -15 / 4 * (sum(((repmat(sum(((repmat(sum(((A .* A)' .* (A .* A)')', 2), 1, m) .* A) .* A), 2), 1, m) .* A) .* A), 2)) + 1 / 336 * (sum((repmat(sum((repmat(sum((repmat(sum((repmat(sum((repmat(sum((repmat(sum(A, 2), 1, m) .* (repmat(sum(A, 2), 1, m) .* A)), 2), 1, m) .* A), 2), 1, m) .* A), 2), 1, m) .* A), 2), 1, m) .* A), 2), 1, m) .* A), 2)) + -10 * (sum((repmat(sum(((repmat(sum(((A .* A)' .* (A .* A)')', 2), 1, m) .* A)' .* (A .* A)')', 2), 1, m) .* A), 2)) + 1 / 3 * (sum(((repmat(sum((repmat(sum((repmat(sum((repmat(sum(A, 2), 1, m) .* (repmat(sum(A, 2), 1, m) .* A)), 2), 1, m) .* A), 2), 1, m) .* A), 2), 1, m) .* A)' .* (A .* A)')', 2)) + -12 * (sum((repmat(sum(((repmat(sum((((A .* A)' .* (A .* A)') .* A')', 2), 1, m) .* A) .* A), 2), 1, m) .* A), 2)) + -10 / 3 * (sum(((repmat(sum(((repmat(sum((A .* A), 2), 1, m) .* A)' .* (A .* A)')', 2), 1, m) .* A)' .* (A .* A)')', 2))) / 120;
normalization = sum(abs(original(:)));
assert(sum(abs(original(:) - optimized(:))) / normalization < 1e-10);